(()=>{function c(e,i,t="",o=!0){e.title=t,e.tree=document.createElement("div");let r=async()=>{await e.compose(),i.replaceChildren(e.tree)};e.start=s=>{r(),o&&!e.id&&(e.id=setInterval(()=>{document.visibilityState==="visible"&&r()},s))},e.stop=()=>{clearInterval(e.id),e.id=null}}var n={cookie:(e,i=null)=>{let t=["",i];return i!==null?document.cookie=`${e}=${i}; SameSite=Strict`:t=document.cookie.match(new RegExp(`${e}=([\\d]+)`)),(t==null?void 0:t.length)>1?t[1]:null},http:async(e,i="GET")=>{try{let t=await fetch(e,{method:i,headers:{"Content-type":"application/json"}});if(t.ok)return await t.json()}catch(t){return null}}};function d(e){c(this,e,"Pilot list"),this.compose=async()=>{let i=await n.http("api");if(this.tree.innerHTML=`<h1>Perimeter violations in last 10 min</h1>
            <button>Toggle frequency (${n.interval/1e3} sec)</button>
            <div></div>`,this.tree.querySelector("button").addEventListener("click",()=>{n.interval=n.interval==2e3?1e4:2e3,this.stop(),this.start(n.cookie("interval",n.interval))}),i){let t=this.tree.querySelector("div");i.sort((o,r)=>parseFloat(o.radius)>parseFloat(r.radius));for(let o of i)o.radius=parseInt(o.radius)/1e3,t.innerHTML+=`<p>${o.radius}m:
                        ${o.name}, ${o.phone}, ${o.email}</p>`}else this.tree.innerHTML="<p>Connection error. Retrying...</p>"}}function u(e){c(this,e,"Radar"),this.dot=(i,t,o=null,r=!0,s=4)=>{let a=this.canvas.getContext("2d");a.beginPath(),a.arc(i,t,s,0,360),r?a.fill():a.stroke(),a.font="20px sans-serif",o&&a.fillText(o,i+s+2,t+6)},this.compose=async()=>{let i=await n.http("api/coords");if(this.tree.innerHTML=`<h1>Drone radar</h1>
            <p>Closest position of every detected drone</p>
            <canvas></canvas>`,this.canvas=this.tree.querySelector("canvas"),this.canvas.height=this.canvas.width=1120,this.dot(560,560,"100m",!1,500),this.dot(560,560,"50m",!1,250),this.dot(560,560,"Monadikuikka"),i)for(let t of i)this.dot((t.x-138e3)/200,(t.y-138e3)/200,t.name)}}function f(e){c(this,e,"Info",!1),this.compose=async()=>{this.tree.innerHTML=`<h1>Project information</h1>
            <p>Project assignment can be viewed at: <a href='https://assignments.reaktor.com/birdnest/'>https://assignments.reaktor.com/birdnest/</a></p>
            <p>Everything regarding project definition and requirements are &copy; Reaktor, Inc.</p>
            <p>Repository available at: <a href='https://github.com/pfnisu/birdnest'>https://github.com/pfnisu/birdnest</a></p>
            <h1>Licence</h1>
            <p>Copyright (C) 2022-2023 Niko Suoniemi <niko@tamperelainen.org></p>
            <p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, version 3.</p>
            <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.</p>
            <p>You should have received a copy of the GNU Affero General Public License along with this program. If not, see <a href='https://www.gnu.org/licenses/'>https://www.gnu.org/licenses/</a></p>`}}var h=document.querySelector("nav"),p=document.querySelector("main"),l=[new d(p),new u(p),new f(p)],m=e=>{var t,o;l.forEach(r=>r.stop()),h.innerHTML=l.reduce((r,s)=>`${r}<a>${s.title}</a>`,"");let i=e?l.findIndex(r=>r.title===e.target.textContent):(t=n.cookie("tab"))!=null?t:0;h.children[i].className="active",document.title=`Birdnest - ${l[i].title}`,e||(n.interval=(o=n.cookie("interval"))!=null?o:1e4),l[i].start(n.interval),n.cookie("tab",i)};m();h.addEventListener("click",m,!0);})();
