(()=>{function c(e,i,t="",s=!0){e.root=i,e.title=t,e.tree=document.createElement("div"),this.compose=()=>{e.root.replaceChildren(e.tree)},e.start=async o=>{await e.compose(),s&&!e.id&&(e.id=setInterval(()=>{document.visibilityState==="visible"&&e.compose()},o))},e.stop=()=>{clearInterval(e.id),e.id=null}}var n={cookie:(e,i=null)=>{let t=["",i];return i!==null?document.cookie=`${e}=${i}; SameSite=Strict`:t=document.cookie.match(new RegExp(`${e}=([\\d]+)`)),(t==null?void 0:t.length)>1?t[1]:null},http:async(e,i="GET")=>{try{let t=await fetch(e,{method:i,headers:{"Content-type":"application/json"}});return t.ok&&t.status!=204?await t.json():t.ok}catch{console.log(`${i} request failed`)}}};function d(e){let i=new c(this,e,"Pilot list");this.compose=async()=>{let t=await n.http("api");this.tree.innerHTML=`<h1>Perimeter violations in last 10 min</h1>
            <button>Toggle frequency (${n.interval/1e3} sec)</button>
            <div></div>`,this.tree.querySelector("button").addEventListener("click",()=>{n.interval=n.interval==2e3?1e4:2e3,this.stop(),this.start(n.cookie("interval",n.interval)),this.compose()});let s=this.tree.querySelector("div");t.sort((o,r)=>parseFloat(o.radius)>parseFloat(r.radius));for(let o of t)o.radius=parseInt(o.radius)/1e3,s.innerHTML+=`<p>${o.radius}m:
                    ${o.name}, ${o.phone}, ${o.email}</p>`;i.compose()}}function m(e){let i=new c(this,e,"Radar");this.dot=(t,s,o=null,r=!0,h=4)=>{let a=this.canvas.getContext("2d");a.beginPath(),a.arc(t,s,h,0,360),r?a.fill():a.stroke(),a.font="20px sans-serif",o&&a.fillText(o,t+h+2,s+6)},this.compose=async()=>{let t=await n.http("api/coords");this.tree.innerHTML=`<h1>Drone radar</h1>
            <p>Closest position of every detected drone</p>
            <canvas></canvas>`,this.canvas=this.tree.querySelector("canvas"),this.canvas.height=this.canvas.width=1120,this.dot(560,560,"100m",!1,500),this.dot(560,560,"50m",!1,250),this.dot(560,560,"Monadikuikka");for(let s of t)this.dot((s.x-138e3)/200,(s.y-138e3)/200,s.name);i.compose()}}function u(e){let i=new c(this,e,"Info",!1);this.compose=async()=>{this.tree.innerHTML=`<h1>Project information</h1>
            <p>Project assignment can be viewed at: <a href='https://assignments.reaktor.com/birdnest/'>https://assignments.reaktor.com/birdnest/</a></p>
            <p>Everything regarding project definition and requirements are &copy; Reaktor, Inc.</p>
            <p>Repository available at: <a href='https://github.com/pfnisu/birdnest'>https://github.com/pfnisu/birdnest</a></p>
            <h1>Licence</h1>
            <p>Copyright (C) 2022-2023 Niko Suoniemi <niko@tamperelainen.org></p>
            <p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, version 3.</p>
            <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.</p>
            <p>You should have received a copy of the GNU Affero General Public License along with this program. If not, see <a href='https://www.gnu.org/licenses/'>https://www.gnu.org/licenses/</a></p>`,i.compose()}}var b="Birdnest",p=document.querySelector("main"),l=[new d(p),new m(p),new u(p)],f=l.map(e=>e.title),v=document.querySelector("nav");v.innerHTML=f.reduce((e,i)=>`${e}<a>${i}</a>`,"");var w=async e=>{var s,o;l.forEach(r=>r.stop());let i=document.querySelectorAll("nav a");i.forEach(r=>r.className="");let t=e?f.indexOf(e.target.textContent):(s=n.cookie("tab"))!=null?s:0;i[t].className+="active",document.title=`${b} - ${l[t].title}`,n.interval=(o=n.cookie("interval"))!=null?o:1e4,l[t].start(n.interval),n.cookie("tab",t)};w();v.addEventListener("click",w,!0);})();
